<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <title>Potree Viewer</title>

    <link rel="stylesheet" type="text/css" href="../build/potree/potree.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="../libs/jquery-ui/jquery-ui.min.css"
    />
    <link rel="stylesheet" type="text/css" href="../libs/openlayers3/ol.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="../libs/spectrum/spectrum.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="../libs/jstree/themes/mixed/style.css"
    />
  </head>

  <body>
    <script src="../libs/jquery/jquery-3.1.1.min.js"></script>
    <script src="../libs/spectrum/spectrum.js"></script>
    <script src="../libs/jquery-ui/jquery-ui.min.js"></script>

    <script src="../libs/other/BinaryHeap.js"></script>
    <script src="../libs/tween/tween.min.js"></script>
    <script src="../libs/d3/d3.js"></script>
    <script src="../libs/proj4/proj4.js"></script>
    <script src="../libs/openlayers3/ol.js"></script>
    <script src="../libs/i18next/i18next.js"></script>
    <script src="../libs/jstree/jstree.js"></script>
    <script src="../build/potree/potree.js"></script>
    <script src="../libs/plasio/js/laslaz.js"></script>

    <!-- INCLUDE ADDITIONAL DEPENDENCIES HERE -->
    <!-- INCLUDE SETTINGS HERE -->

    <div
      class="potree_container"
      style="position: absolute; width: 100%; height: 100%; left: 0px; top: 0px"
    >
      <div
        id="potree_render_area"
        style="
          background-image: url('../build/potree/resources/images/background.jpg');
        "
      >
        <span
          style="
            position: absolute;
            bottom: 10px;
            right: 0;
            transform: translateX(-50%);
            background-color: white;
            border-radius: 0.5em;
            padding: 1em;
            z-index: 10000;
          "
        >
          <h3 style="margin: 0 0 0.5em 0; font-family: Arial; font-size: 1.2em">
            Color Variable
          </h3>
          <form style="display: flex; flex-direction: column; gap: 0.5em">
            <label>
              <input
                type="radio"
                name="attribute"
                value="rgba"
                onclick="setActiveAttributeName('rgba')"
                checked
              />
              RGBA
            </label>
            <label>
              <input
                type="radio"
                name="attribute"
                value="classification"
                onclick="setActiveAttributeName('classification')"
              />
              Classification
            </label>
            <label>
              <input
                type="radio"
                name="attribute"
                value="intensity"
                onclick="setActiveAttributeName('intensity')"
              />
              Intensity
            </label>
            <label>
              <input
                type="radio"
                name="attribute"
                value="elevation"
                onclick="setActiveAttributeName('elevation')"
              />
              Elevation
            </label>
            <label>
              <input
                type="radio"
                name="attribute"
                value="Group"
                onclick="setActiveAttributeName('Group')"
              />
              Group
            </label>
            <label>
              <input
                type="radio"
                name="attribute"
                value="Normal"
                onclick="setActiveAttributeName('Normal')"
              />
              Normal
            </label>
            <label>
              <input
                type="radio"
                name="attribute"
                value="Distance"
                onclick="setActiveAttributeName('Distance')"
              />
              Distance
            </label>
            <label>
              <input
                type="radio"
                name="attribute"
                value="gps-time"
                onclick="setActiveAttributeName('gps-time')"
              />
              GPS Time
            </label>
          </form>
        </span>
      </div>
      <div id="potree_sidebar_container"></div>
    </div>

    <script type="module">
      import * as THREE from "../libs/three.js/build/three.module.js";

      window.viewer = new Potree.Viewer(
        document.getElementById("potree_render_area")
      );

      viewer.setEDLEnabled(true);
      viewer.setFOV(60);
      viewer.setPointBudget(1_000_000);
      viewer.loadSettingsFromURL();

      viewer.setDescription("");

      viewer.loadGUI(() => {
        viewer.setLanguage("en");
        $("#menu_appearance").next().show();
        //viewer.toggleSidebar();
      });

      let url = "https://enacit4r-cdn.epfl.ch/AddLidar/data/metadata.json";
      Potree.loadPointCloud(url).then((e) => {
        let pointcloud = e.pointcloud;
        let material = pointcloud.material;

        material.minSize = 1;
        material.pointSizeType = Potree.PointSizeType.ADAPTIVE;
        material.activeAttributeName = "rgba";

        viewer.scene.addPointCloud(pointcloud);
        viewer.fitToScreen();
      });

      window.setActiveAttributeName = function (name) {
        let pointcloud = viewer.scene.pointclouds[0];
        let material = pointcloud.material;
        material.activeAttributeName = name;
      };
    </script>
  </body>
</html>
